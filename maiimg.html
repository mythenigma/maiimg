<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="keywords" content="image hosting,image upload,photo sharing,image qr code,free image host,secure image sharing">
  <meta name="description" content="Upload and share images instantly with QR codes. Secure, fast, and free image hosting service with tracking and analytics.">
  <!-- Favicon -->
      <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/svg+xml" href="favicon.svg">
  <meta name="author" content="MaiPDF">
  
  <!-- SEO -->
  <link rel="sitemap" type="application/xml" href="/sitemap.xml">
  <meta name="robots" content="index, follow">
  <title>Image QR Generator - Upload & Share Images with QR Codes</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9224406325142860" crossorigin="anonymous"></script>

  <!-- Cloudflare CDN Resources -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css" rel="stylesheet">
  
  <!-- Custom Styles -->
  <link href="qr-styles010.css" rel="stylesheet">
  
  <!-- Internationalization -->
  <script src="i18n.js"></script>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#hero">
        <i class="fas fa-images me-2"></i><span data-translate="nav.title">Image QR Generator</span>
      </a>
      
      <!-- Language Selector -->
      <div class="language-selector">
        <div class="dropdown">
          <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <span id="currentLanguageFlag">üá∫üá∏</span>
            <span id="currentLanguageName" data-translate="language.english">English</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('en')">
                <span class="flag-icon">üá∫üá∏</span>
                <span data-translate="language.english">English</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('zh')">
                <span class="flag-icon">üá®üá≥</span>
                <span data-translate="language.chinese">‰∏≠Êñá</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('tw')">
                <span class="flag-icon">üáπüáº</span>
                <span data-translate="language.taiwan">‰∏≠ËèØÊ∞ëÂúã</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('ja')">
                <span class="flag-icon">üáØüáµ</span>
                <span data-translate="language.japanese">Êó•Êú¨Ë™û</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('de')">
                <span class="flag-icon">üá©üá™</span>
                <span data-translate="language.german">Deutsch</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('ko')">
                <span class="flag-icon">üá∞üá∑</span>
                <span data-translate="language.korean">ÌïúÍµ≠Ïñ¥</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('fr')">
                <span class="flag-icon">üá´üá∑</span>
                <span data-translate="language.french">Fran√ßais</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" onclick="changeLanguage('it')">
                <span class="flag-icon">üáÆüáπ</span>
                <span data-translate="language.italian">Italiano</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero-section" id="hero">
    <div class="container">
      <h1 class="hero-title">
        <i class="fas fa-cloud-upload-alt"></i><br>
        <span data-translate="hero.title">Upload & Share Images</span>
      </h1>
      <p class="hero-subtitle" data-translate="hero.subtitle">
        Turn your images into shareable QR codes with advanced tracking and analytics
      </p>
    </div>
  </section>

  <div class="container">
    <!-- Main Upload Section -->
    <section class="main-upload-section" id="upload">
      <div class="text-center mb-4">
        <h2 class="section-title" data-translate="upload.title">Image Upload Center</h2>
        <p class="section-subtitle" data-translate="upload.subtitle">Drag & drop your images or click to browse</p>
        
        <!-- Feature Badges -->
        <div class="feature-badges mb-4">
          <span class="badge badge-secure">
            <i class="fas fa-shield-alt"></i>
            <span data-translate="badges.secure">Secure</span>
          </span>
          <span class="badge badge-fast">
            <i class="fas fa-bolt"></i>
            <span data-translate="badges.fast">Fast</span>
          </span>
          <span class="badge badge-free">
            <i class="fas fa-gift"></i>
            <span data-translate="badges.free">Free</span>
          </span>
        </div>
      </div>

      <!-- Upload Zone -->
      <div class="upload-area" id="dropz">
        <i class="fas fa-cloud-upload-alt upload-icon"></i>
        <div class="upload-text" data-translate="upload.dropText">Drop images here or click to upload</div>
        <div class="upload-subtext" data-translate="upload.supportText">
          Supports: PNG, JPG, JPEG, GIF, WebP ‚Ä¢ Max 50MB each ‚Ä¢ Up to 25 files
        </div>
        <div class="mt-3">
          <span class="badge bg-primary px-3 py-2">
            <span data-translate="badges.secure">Secure</span>
          </span>
          <span class="badge bg-success px-3 py-2">
            <span data-translate="badges.fast">Fast</span>
          </span>
          <span class="badge bg-info px-3 py-2">
            <span data-translate="badges.free">Free</span>
          </span>
        </div>
      </div>

      <div class="row">
        <div class="col-12 mb-4">
          <div class="alert alert-info border-0 rounded-4" id="uploadStatus">
            <i class="fas fa-info-circle me-2"></i>
            <span id="pleaseupload" data-translate="upload.ready">Ready to upload images</span>
          </div>
        </div>
      </div>

      <!-- File Preview Area -->
      <div class="file-preview-area" id="filePreviewArea" style="display: none;">
        <h4>Selected Images</h4>
        <div class="file-grid" id="fileGrid"></div>
      </div>
    </section>

    <!-- Configuration Section -->
    <section class="config-section" id="config">
      <div class="feature-cards">
        <div class="feature-card">
          <i class="fas fa-shield-alt feature-icon"></i>
          <h5 class="feature-title">Access Control</h5>
          <input class="form-control mb-2" type="number" id="limit" data-translate-placeholder="features.viewLimit.placeholder" placeholder="Max views (required)" min="1" max="99999999" required>
          <input class="form-control" type="number" id="password" data-translate-placeholder="features.timeControl.placeholder" placeholder="Seconds per view (required)" min="1" max="99999999" required>
          <small class="text-muted">Set both view limit and per-view duration in one panel</small>
        </div>
        
        <div class="feature-card">
          <i class="fas fa-tag feature-icon"></i>
          <h5 class="feature-title" data-translate="features.description.title">Description</h5>
          <input class="form-control" type="text" id="caption" data-translate-placeholder="features.description.placeholder" placeholder="Add a description (required)" maxlength="100" required>
          <small class="text-muted" data-translate="features.description.description">Enter image description</small>
        </div>

        <div class="feature-card">
          <i class="fas fa-hourglass-half feature-icon"></i>
          <h5 class="feature-title">Expiration</h5>
          <select class="form-select mb-2" id="expiration_preset" aria-label="Expiration preset">
            <option value="" selected>Select expiration</option>
            <option value="1h">1 hour</option>
            <option value="3h">3 hours</option>
            <option value="24h">24 hours</option>
            <option value="5d">5 days</option>
            <option value="custom">Custom days</option>
            <option value="unlimited">Unlimited</option>
          </select>
          <input class="form-control mb-2" type="number" id="expiration_custom_days" min="1" step="1" placeholder="Custom days" style="display:none;">
          <input type="hidden" id="expiration_day" value="">
          <input type="hidden" id="expiration_ts" value="">
          <small class="text-muted d-block mb-1" id="expiration_result" style="display:none;">UTC expiry time: -</small>
          <div id="timezone_row" style="display:none;">
            <select class="form-select form-select-sm mb-2" id="timezone_tz" aria-label="Time zone"></select>
          </div>
          <small class="text-muted d-block" id="expiration_local" style="display:none;">Local time: -</small>
        </div>
        
        <div class="feature-card">
          <i class="fas fa-magic feature-icon"></i>
          <h5 class="feature-title" data-translate="features.generate.title">Generate Link & QR</h5>
          <button type="button" class="btn btn-primary w-100" onclick="generateImageQR()" disabled id="generateBtn">
            <i class="fas fa-link me-2"></i><span data-translate="features.generate.button">Create Link & QR Code</span>
          </button>
          <small class="text-muted" id="generateBtnStatus" data-translate="features.generate.status">Fill all fields and upload images first</small>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section id="results" class="results-section" style="display: none;">
      <!-- Success Header with Animation -->
      <div class="success-header text-center mb-5">
        <div class="success-icon-container">
          <i class="fas fa-check-circle success-icon"></i>
        </div>
        <h2 class="success-title">
          <span data-translate="results.success">QR Code Generated Successfully!</span>
        </h2>
        <p class="success-subtitle" data-translate="results.subtitle">Your image gallery link and QR code are ready to share</p>
      </div>

      <!-- Enhanced Statistics Cards -->
      <div class="stats-container mb-3">
        <div class="row g-2">
          <div class="col-md-4 col-sm-6">
            <div class="stat-card-enhanced">
              <div class="stat-icon">
                <i class="fas fa-images"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="fileCount">0</div>
                <div class="stat-label" data-translate="results.stats.images">Images</div>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-sm-6">
            <div class="stat-card-enhanced">
              <div class="stat-icon">
                <i class="fas fa-eye"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="viewLimit">‚àû</div>
                <div class="stat-label" data-translate="results.stats.views">Views</div>
              </div>
            </div>
          </div>
          <div class="col-md-4 col-sm-12">
            <div class="stat-card-enhanced">
              <div class="stat-icon">
                <i class="fas fa-hourglass-half"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="expirationDisplay">Never</div>
                <div class="stat-label">Expiration</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Cards -->
      <div class="row g-4 mb-5 align-items-stretch">
        <!-- Share Link & QR Code -->
        <div class="col-12 col-lg-7">
          <div class="result-card h-100" id="share-link-section">
            <div class="result-card-body">
              <div class="share-link-container">
                <div class="gallery-link-header">
                  <label class="form-label mb-0" id="gallery-link-title">Gallery Link</label>
                  <span class="gallery-link-arrow" aria-hidden="true">
                    <i class="fas fa-arrow-right"></i>
                  </span>
                  <a href="#insights-section" class="gallery-link-jump" title="Go to Insights">
                    <i class="fas fa-chart-line"></i>
                  </a>
                </div>
                <div class="input-group mb-2">
                  <input type="text" class="form-control" id="webinputpic" readonly placeholder="Generated link will appear here">
                  <button class="btn btn-primary" type="button" onclick="myFunctionpic()">
                    <i class="fas fa-copy me-1"></i>Copy
                  </button>
                </div>
                <div id="Copied" class="copy-feedback"></div>
              </div>

              <div class="inline-qr-block text-center mt-3">
                <div id="qrcodewebpic" class="qr-container-enhanced">
                  <p class="text-muted">QR code will appear here</p>
                </div>
                <small class="text-muted mt-2 d-block">Scan to access gallery</small>
              </div>
              
              <div class="action-buttons mt-3">
                <button type="button" class="btn btn-success me-2" onclick="window.open(document.getElementById('webinputpic').value, '_blank')">
                  <i class="fas fa-external-link-alt me-1"></i><span data-translate="results.openGallery">Open Gallery</span>
                </button>
                <button type="button" class="btn btn-outline-secondary" onclick="location.reload()">
                  <i class="fas fa-plus me-1"></i><span data-translate="results.createAnother">Create Another</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tracking Information -->
        <div class="col-12 col-lg-5">
          <div class="result-card tracking-card h-100" id="insights-section">
            <div class="result-card-header">
              <h5><i class="fas fa-list-check me-2"></i>Access Records</h5>
            </div>
            <div class="result-card-body">
              <div id="btypesay" class="tracking-info">
                <!-- Insight info will be inserted here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tools Section -->
    <section class="tools-section" id="tools">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="section-title" data-translate="tools.title">Other QR Tools</h2>
          <p class="section-subtitle" data-translate="tools.subtitle">Quick access to other QR code generators</p>
        </div>
        
        <div class="row g-4">
          <div class="col-md-3 col-sm-6">
            <div class="tool-card" data-bs-toggle="modal" data-bs-target="#wifi-modal">
              <div class="tool-icon">
                <i class="fas fa-wifi"></i>
              </div>
              <h5 data-translate="tools.wifi">WiFi QR</h5>
            </div>
          </div>
          
          <div class="col-md-3 col-sm-6">
            <div class="tool-card" data-bs-toggle="modal" data-bs-target="#sms-modal">
              <div class="tool-icon">
                <i class="fas fa-sms"></i>
              </div>
              <h5 data-translate="tools.sms">SMS QR</h5>
            </div>
          </div>
          
          <div class="col-md-3 col-sm-6">
            <div class="tool-card" data-bs-toggle="modal" data-bs-target="#url-modal">
              <div class="tool-icon">
                <i class="fas fa-link"></i>
              </div>
              <h5 data-translate="tools.url">URL QR</h5>
            </div>
          </div>
          
          <div class="col-md-3 col-sm-6">
            <div class="tool-card" data-bs-toggle="modal" data-bs-target="#phone-modal">
              <div class="tool-icon">
                <i class="fas fa-phone"></i>
              </div>
              <h5 data-translate="tools.phone">Phone QR</h5>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- WiFi QR Code Modal -->
  <div class="modal fade" id="wifi-modal" tabindex="-1" aria-labelledby="wifiModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="wifiModalLabel">
            <i class="fas fa-wifi me-2"></i><span data-translate="modals.wifi.title">WiFi QR Code Generator</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="myInput1" class="form-label" data-translate="modals.wifi.networkName">Network Name (SSID)</label>
            <input type="text" class="form-control" id="myInput1" data-translate-placeholder="modals.wifi.networkPlaceholder" placeholder="Enter WiFi network name">
          </div>
          
          <div class="mb-3">
            <label for="myInput2" class="form-label" data-translate="modals.wifi.securityType">Security Type</label>
            <select class="form-control" id="myInput2">
              <option value="WPA" data-translate="modals.wifi.wpa">WPA/WPA2</option>
              <option value="WEP" data-translate="modals.wifi.wep">WEP</option>
              <option value="nopass" data-translate="modals.wifi.noPassword">No Password</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="myInput3" class="form-label" data-translate="modals.wifi.password">Password</label>
            <input type="password" class="form-control" id="myInput3" data-translate-placeholder="modals.wifi.passwordPlaceholder" placeholder="Enter WiFi password">
          </div>
          
          <button type="button" class="btn btn-primary w-100" onclick="makeCode()">
            <i class="fas fa-qrcode me-2"></i><span data-translate="modals.wifi.generate">Generate WiFi QR Code</span>
          </button>
          
          <div class="mt-4">
            <h6><i class="fas fa-qrcode me-2"></i><span data-translate="modals.common.qrPreview">QR Code Preview</span></h6>
            <div id="qrcode" class="qr-container">
              <p class="text-muted" data-translate="modals.common.qrPlaceholder">Your WiFi QR code will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SMS QR Code Modal -->
  <div class="modal fade" id="sms-modal" tabindex="-1" aria-labelledby="smsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="smsModalLabel">
            <i class="fas fa-sms me-2"></i><span data-translate="modals.sms.title">SMS QR Code Generator</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="smsNumber" class="form-label" data-translate="modals.sms.phoneNumber">Phone Number</label>
            <input type="tel" class="form-control" id="smsNumber" data-translate-placeholder="modals.sms.phonePlaceholder" placeholder="Enter phone number">
          </div>
          
          <div class="mb-3">
            <label for="smsContent" class="form-label" data-translate="modals.sms.messageContent">Message Content</label>
            <textarea class="form-control" rows="4" id="smsContent" data-translate-placeholder="modals.sms.messagePlaceholder" placeholder="Enter your message"></textarea>
          </div>
          
          <button type="button" class="btn btn-primary w-100" onclick="makeCode()">
            <i class="fas fa-qrcode me-2"></i><span data-translate="modals.sms.generate">Generate SMS QR Code</span>
          </button>
          
          <div class="mt-4">
            <h6><i class="fas fa-qrcode me-2"></i><span data-translate="modals.common.qrPreview">QR Code Preview</span></h6>
            <div id="smsCode" class="qr-container">
              <p class="text-muted" data-translate="modals.common.qrPlaceholder">Your SMS QR code will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Phone QR Code Modal -->
  <div class="modal fade" id="phone-modal" tabindex="-1" aria-labelledby="phoneModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="phoneModalLabel">
            <i class="fas fa-phone me-2"></i><span data-translate="modals.phone.title">Phone QR Code Generator</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="telinput" class="form-label" data-translate="modals.phone.phoneNumber">Phone Number</label>
            <input type="tel" class="form-control" id="telinput" data-translate-placeholder="modals.phone.phonePlaceholder" placeholder="Enter phone number">
          </div>
          
          <button type="button" class="btn btn-primary w-100" onclick="makeCodeweb()">
            <i class="fas fa-qrcode me-2"></i><span data-translate="modals.phone.generate">Generate Phone QR Code</span>
          </button>
          
          <div class="mt-4">
            <h6><i class="fas fa-qrcode me-2"></i><span data-translate="modals.common.qrPreview">QR Code Preview</span></h6>
            <div id="qrcodetel" class="qr-container">
              <p class="text-muted" data-translate="modals.common.qrPlaceholder">Your phone QR code will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- URL QR Code Modal -->
  <div class="modal fade" id="url-modal" tabindex="-1" aria-labelledby="urlModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="urlModalLabel">
            <i class="fas fa-link me-2"></i><span data-translate="modals.url.title">URL QR Code Generator</span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="webinput" class="form-label" data-translate="modals.url.websiteUrl">Website URL</label>
            <input type="url" class="form-control" id="webinput" value="https://" data-translate-placeholder="modals.url.urlPlaceholder" placeholder="Enter website URL">
          </div>
          
          <button type="button" class="btn btn-primary w-100" onclick="makeCodeweb()">
            <i class="fas fa-qrcode me-2"></i><span data-translate="modals.url.generate">Generate URL QR Code</span>
          </button>
          
          <div class="mt-4">
            <h6><i class="fas fa-qrcode me-2"></i><span data-translate="modals.common.qrPreview">QR Code Preview</span></h6>
            <div id="qrcodeweb" class="qr-container">
              <p class="text-muted" data-translate="modals.common.qrPlaceholder">Your URL QR code will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-links mb-3">
        <a href="blog/">
          <i class="fas fa-blog me-1"></i>MaiIMG Blog
        </a>
        <a href="https://www.maipdf.com">
          <i class="fas fa-home me-1"></i>MaiPDF Home
        </a>
        <a href="https://article.maipdf.com">
          <i class="fas fa-code me-1"></i>Developer Tools
        </a>
      </div>
      <p class="mb-0">
        <i class="fas fa-copyright me-1"></i>2026 MaiPDF - 
        <a href="mailto:joe@pdfhost.online">joe@pdfhost.online</a>
      </p>
      <small class="text-muted" id="footerComplianceText">Thank you</small>
    </div>
  </footer>

  <!-- Cloudflare CDN Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  
  <script>
    // Global variables for generated codes
    let generatedTypeA = 'Reader';
    let generatedTypeB = 'Tracker';
    let uploadedFiles = [];
    let currentUploadSessionId = null; // ‰øùÊåÅ‰∏∫ nullÔºåÂú®Á¨¨‰∏ÄÊ¨°‰∏ä‰º†Êó∂ÁîüÊàê
    let myDropzone; // Ê∑ªÂä†ÂÖ®Â±ÄÂèòÈáèÊù•Â≠òÂÇ® dropzone ÂÆû‰æã

    // Language functionality
    let currentLanguage = 'en';

    // Initialize translations when page loads
    function initializeTranslations() {
      // i18n system is already initialized in i18n.js
      // No need to do anything here
    }

    // Change language function
    function changeLanguage(lang) {
      console.log('Changing language to:', lang); // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
      // Use the global i18n instance from i18n.js
      if (window.i18n) {
        window.i18n.setLanguage(lang);
        currentLanguage = lang;
        updateFooterComplianceText(lang);
        
        // ‰øùÂ≠òËØ≠Ë®ÄÂÅèÂ•ΩÂà∞ localStorage
        localStorage.setItem('preferred-language', lang);
        
        console.log('Language changed successfully to:', lang);
      } else {
        console.error('i18n instance not found');
      }
    }

    // Update all translations on the page
    function updateTranslations() {
      // This is now handled by i18n.js
      if (window.i18n) {
        window.i18n.updatePageTranslations();
      }
    }

    // Update placeholder texts
    function updatePlaceholders() {
      // This is now handled by i18n.js
      if (window.i18n) {
        window.i18n.updatePageTranslations();
      }
    }

    // Get translation for a specific key and language
    function getTranslation(key, lang) {
      // Use the global i18n instance
      if (window.i18n) {
        return window.i18n.t(key);
      }
      return key; // fallback
    }

    // Update footer compliance text based on selected language
    function updateFooterComplianceText(lang) {
      const footerText = document.getElementById('footerComplianceText');
      if (!footerText) return;
      if (lang === 'zh') {
        footerText.innerHTML = '<a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">Ê≤™ICPÂ§á15021410Âè∑</a>';
      } else {
        footerText.textContent = 'Thank you';
      }
    }

    // ÂèØÈÄÜÂ§çÊùÇÁºñÁ†ÅÁ≥ªÁªü
    class ReversibleEncoder {
      constructor() {
        // Ëá™ÂÆö‰πâÂ≠óÁ¨¶ÈõÜ (ÈÅøÂÖçÊòìÊ∑∑Ê∑ÜÂ≠óÁ¨¶ 0, O, 1, I, l)
        this.charset = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789abcdefghjkmnpqrstuvwxyz';
        this.base = this.charset.length; // 58
        
        // Âõ∫ÂÆöÂØÜÈí• (ÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰øÆÊîπ)
        this.secretKey = 0x5A5A5A5A; // ÂºÇÊàñÂØÜÈí•
        
        // Â≠óÁ¨¶ÊõøÊç¢Êò†Â∞Ñ (Â¢ûÂä†Â§çÊùÇÂ∫¶)
        this.charMap = {
          'A': 'X', 'B': 'Y', 'C': 'Z', 'D': 'a', 'E': 'b',
          'F': 'c', 'G': 'd', 'H': 'e', 'J': 'f', 'K': 'g',
          'L': 'h', 'M': 'j', 'N': 'k', 'P': 'm', 'Q': 'n',
          'R': 'p', 'S': 'q', 'T': 'r', 'U': 's', 'V': 't',
          'W': 'u', 'X': 'v', 'Y': 'w', 'Z': 'x', '2': 'y',
          '3': 'z', '4': 'A', '5': 'B', '6': 'C', '7': 'D',
          '8': 'E', '9': 'F', 'a': 'G', 'b': 'H', 'c': 'J',
          'd': 'K', 'e': 'L', 'f': 'M', 'g': 'N', 'h': 'P',
          'j': 'Q', 'k': 'R', 'm': 'S', 'n': 'T', 'p': 'U',
          'q': 'V', 'r': 'W', 's': '2', 't': '3', 'u': '4',
          'v': '5', 'w': '6', 'x': '7', 'y': '8', 'z': '9'
        };
        
        // ÂèçÂêëÊò†Â∞Ñ
        this.reverseCharMap = {};
        for (let [key, value] of Object.entries(this.charMap)) {
          this.reverseCharMap[value] = key;
        }
      }
      
      // ËÆ°ÁÆóÊ†°È™å‰Ωç
      calculateChecksum(str) {
        let sum = 0;
        for (let i = 0; i < str.length; i++) {
          sum += str.charCodeAt(i) * (i + 1);
        }
        return this.charset[sum % this.base];
      }
      
      // È™åËØÅÊ†°È™å‰Ωç
      verifyChecksum(str) {
        if (str.length < 2) return false;
        const checksum = str[str.length - 1];
        const data = str.slice(0, -1);
        return this.calculateChecksum(data) === checksum;
      }
      
      // Base58 ÁºñÁ†Å
      toBase58(num) {
        if (num === 0) return this.charset[0];
        
        let result = '';
        while (num > 0) {
          result = this.charset[num % this.base] + result;
          num = Math.floor(num / this.base);
        }
        return result;
      }
      
      // Base58 Ëß£Á†Å
      fromBase58(str) {
        let result = 0;
        let power = 1;
        
        for (let i = str.length - 1; i >= 0; i--) {
          const index = this.charset.indexOf(str[i]);
          if (index === -1) throw new Error('Invalid character in encoded string');
          result += index * power;
          power *= this.base;
        }
        return result;
      }
      
      // Â≠óÁ¨¶ÊõøÊç¢
      substituteChars(str) {
        return str.split('').map(char => this.charMap[char] || char).join('');
      }
      
      // Â≠óÁ¨¶ËøòÂéü
      restoreChars(str) {
        return str.split('').map(char => this.reverseCharMap[char] || char).join('');
      }
      
      // ‰ΩçÁΩÆÊâìÊï£ (ÁÆÄÂçïÁöÑÂ•áÂÅ∂‰Ωç‰∫§Êç¢)
      scramblePositions(str) {
        const chars = str.split('');
        const result = [];
        
        // ÂÖàÊîæÂ•áÊï∞‰Ωç
        for (let i = 1; i < chars.length; i += 2) {
          result.push(chars[i]);
        }
        // ÂÜçÊîæÂÅ∂Êï∞‰Ωç
        for (let i = 0; i < chars.length; i += 2) {
          result.push(chars[i]);
        }
        
        return result.join('');
      }
      
      // ‰ΩçÁΩÆËøòÂéü
      unscramblePositions(str) {
        const chars = str.split('');
        const result = new Array(chars.length);
        const half = Math.ceil(chars.length / 2);
        
        let oddIndex = 0, evenIndex = 0;
        
        for (let i = 0; i < chars.length; i++) {
          if (i % 2 === 1) {
            result[i] = chars[oddIndex++];
          } else {
            result[i] = chars[half + evenIndex++];
          }
        }
        
        return result.join('');
      }
      
      // ÁºñÁ†Å‰∏ªÂáΩÊï∞
      encode(autoId) {
        try {
          // 1. ÂºÇÊàñÂä†ÂØÜ
          const encrypted = autoId ^ this.secretKey;
          
          // 2. Base58 ÁºñÁ†Å
          const base58 = this.toBase58(encrypted);
          
          // 3. Â≠óÁ¨¶ÊõøÊç¢
          const substituted = this.substituteChars(base58);
          
          // 4. ‰ΩçÁΩÆÊâìÊï£
          const scrambled = this.scramblePositions(substituted);
          
          // 5. Ê∑ªÂä†Ê†°È™å‰Ωç
          const checksum = this.calculateChecksum(scrambled);
          const final = scrambled + checksum;
          
          return final;
          
        } catch (error) {
          console.error('ÁºñÁ†ÅÈîôËØØ:', error);
          return null;
        }
      }
      
      // Ëß£Á†Å‰∏ªÂáΩÊï∞
      decode(encodedStr) {
        try {
          // 1. È™åËØÅÊ†°È™å‰Ωç
          if (!this.verifyChecksum(encodedStr)) {
            throw new Error('Ê†°È™å‰ΩçÈ™åËØÅÂ§±Ë¥•');
          }
          
          // 2. ÁßªÈô§Ê†°È™å‰Ωç
          const withoutChecksum = encodedStr.slice(0, -1);
          
          // 3. ‰ΩçÁΩÆËøòÂéü
          const unscrambled = this.unscramblePositions(withoutChecksum);
          
          // 4. Â≠óÁ¨¶ËøòÂéü
          const restored = this.restoreChars(unscrambled);
          
          // 5. Base58 Ëß£Á†Å
          const base58Decoded = this.fromBase58(restored);
          
          // 6. ÂºÇÊàñËß£ÂØÜ
          const decrypted = base58Decoded ^ this.secretKey;
          
          return decrypted;
          
        } catch (error) {
          console.error('Ëß£Á†ÅÈîôËØØ:', error);
          return null;
        }
      }
    }

    // ÂàõÂª∫ÂÖ®Â±ÄÁºñÁ†ÅÂô®ÂÆû‰æã
    const trackingEncoder = new ReversibleEncoder();

    // QR Code generation function
    function createQRCode(elementId, text, size = 170) {
      const element = document.getElementById(elementId);
      element.innerHTML = ''; // Clear existing content
      
      if (!text || text.trim() === '') {
        element.innerHTML = '<p class="text-muted">Enter information above to generate QR code</p>';
        return;
      }
      
      try {
        const qr = qrcode(0, 'M');
        qr.addData(text);
        qr.make();
        
        const qrImage = qr.createImgTag(4, 8);
        element.innerHTML = qrImage;
        
        // Style the QR code
        const img = element.querySelector('img');
        if (img) {
          img.style.width = size + 'px';
          img.style.height = size + 'px';
          img.style.border = '1px solid #ddd';
          img.style.borderRadius = '8px';
          img.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
        }
      } catch (error) {
        element.innerHTML = '<p class="text-danger">Error generating QR code</p>';
        console.error('QR code generation error:', error);
      }
    }

    // WiFi and SMS QR Code generation
    function makeCode() {
      const elText1 = document.getElementById("myInput1");
      const elText2 = document.getElementById("myInput2");
      const elText3 = document.getElementById("myInput3");
      const textnumber = document.getElementById("smsNumber");
      const textcontent = document.getElementById("smsContent");
      
      // WiFi QR Code
      if (elText1 && elText1.value.trim()) {
        const elText = `WIFI:S:${elText1.value};T:${elText2.value};P:${elText3.value};;`;
        createQRCode("qrcode", elText);
      }
      
      // SMS QR Code
      if ((textnumber && textnumber.value.trim()) || (textcontent && textcontent.value.trim())) {
        const smstotal = `smsto:${textnumber.value}:${textcontent.value}`;
        createQRCode("smsCode", smstotal);
      }
    }

    // Web, Tel, and Picture QR Code generation
    function makeCodeweb() {
      const tel = document.getElementById("telinput");
      const web = document.getElementById("webinput");
      const webpic = document.getElementById("webinputpic");
      
      if (web && web.value && web.value !== "https://") {
        createQRCode("qrcodeweb", web.value);
      }
      
      if (webpic && webpic.value) {
        createQRCode("qrcodewebpic", webpic.value);
      }
      
      if (tel && tel.value.trim()) {
        createQRCode("qrcodetel", `tel:${tel.value}`);
      }
    }

    // Generate Image QR Code
    async function generateImageQR() {
      if (uploadedFiles.length === 0) {
        showNotification('Please upload at least one image first!', 'warning');
        return;
      }

      const limit = document.getElementById("limit").value || "100000000";
      const password = document.getElementById("password").value || "1999999927";
      const caption = document.getElementById("caption").value || "Image Gallery";
      const expirationDay = document.getElementById("expiration_day").value || "";
      const expirationTs = document.getElementById("expiration_ts").value || "";

      // Show loading state
      const button = event.target;
      const originalText = button.innerHTML;
      button.innerHTML = '<span class="loading"></span> Generating...';
      button.disabled = true;

      try {
        // Call Cloudflare Worker API to create database entry
        const response = await fetch('https://fetch.maipdf.com/api/create-image-link', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            files: uploadedFiles,
            limit: Math.min(parseInt(limit), 99999999),
            password: Math.min(parseInt(password), 99999999),
            caption: caption,
            expiration_day: expirationDay,
            expiration_ts: expirationTs,
            endtime: expirationTs
          })
        });

        const result = await response.json();
        
        if (result.success) {
          // ‰ΩøÁî®Êñ∞ÁöÑÂèØÈÄÜÂ§çÊùÇÁºñÁ†ÅÁÆóÊ≥ï
          const autoId = result.autoId;
          
          // ÁîüÊàê Type A (Êü•ÁúãÈìæÊé•) - ‰øùÊåÅÁÆÄÂçïÁºñÁ†Å
          const identifier = autoId.toString();
          const arr1 = identifier.split('');
          const arrayA = [];
          
          arr1.forEach((digit, i) => {
            let value = parseInt(digit);
            if (value === 0) value = 10;
            arrayA[i] = String.fromCharCode(64 + value); // A=1, B=2, ..., J=10
          });
          
          generatedTypeA = arrayA.join('');
          
          // ÁîüÊàê Type B (ËøΩË∏™‰ª£Á†Å) - ‰ΩøÁî®Â§çÊùÇÁºñÁ†Å
          generatedTypeB = trackingEncoder.encode(autoId);
          
          // Update share link input
          const shareLink = `https://maiimg.com/gallery/${generatedTypeA}`;
          document.getElementById("webinputpic").value = shareLink;

          // Update stats display with enhanced information
          document.getElementById("fileCount").textContent = result.fileCount;
          document.getElementById("viewLimit").textContent = result.limit === 100000000 ? '‚àû' : result.limit.toLocaleString();
          document.getElementById("expirationDisplay").textContent = formatEndtimeDisplay(result.endtime);

          // Update tracking code information in the new enhanced layout
          document.getElementById("btypesay").innerHTML = `
            <div class="insights-intro text-center mb-2">
              These records show when people open your Gallery Link.
            </div>
            <div class="text-center mb-3">
              <div class="tracking-code-display">
                <div class="tracking-code-label">Records Access Code:</div>
                <div class="tracking-code-row">
                  <div class="tracking-code-value">${generatedTypeB}</div>
                  <button class="btn btn-outline-secondary btn-sm tracking-copy-btn" onclick="copyTrackingCode('${generatedTypeB}')">
                    <i class="fas fa-copy me-1"></i>Copy Code
                  </button>
                </div>
              </div>
            </div>
            
            <div class="tracking-info-compact mb-3">
              <div class="gallery-info">
                <i class="fas fa-images me-2"></i>
                <span class="info-text">${result.fileCount} images uploaded</span>
              </div>
            </div>
            
            <div class="text-center">
              <a href="https://maiimg.com/tracking.html?id=${generatedTypeB}" target="_blank" class="btn btn-primary btn-sm">
                <i class="fas fa-external-link-alt me-1"></i>Open Access Records
              </a>
            </div>
            
            <small class="text-muted d-block text-center mt-2">Use this code to view who opened the link and when.</small>
          `;

          // Generate QR code for the share link
          makeCodeweb();

          // Show results section
          document.getElementById("results").style.display = 'block';
          
          // *** ÂÖ≥ÈîÆ‰øÆÊîπÔºöÁîüÊàêÈìæÊé•ÊàêÂäüÂêéÔºåÈáçÁΩÆ‰∏ä‰º†‰ºöËØù ***
          // ÈáçÁΩÆ dropzone Âíå‰∏ä‰º†Áä∂ÊÄÅÔºåÂáÜÂ§á‰∏ã‰∏ÄÊ¨°‰∏ä‰º†
          if (myDropzone) {
            myDropzone.removeAllFiles(true); // Ê∏ÖÈô§ÊâÄÊúâÊñá‰ª∂
          }
          uploadedFiles = []; // Ê∏ÖÁ©∫‰∏ä‰º†Êñá‰ª∂Êï∞ÁªÑ
          currentUploadSessionId = null; // ÈáçÁΩÆ‰ºöËØùIDÔºå‰∏ãÊ¨°‰∏ä‰º†Êó∂‰ºöÁîüÊàêÊñ∞ÁöÑ
          
          // Ê∏ÖÁ©∫Ë°®Âçï
          document.getElementById("limit").value = '';
          document.getElementById("password").value = '';
          document.getElementById("caption").value = '';
          const expirationPresetEl = document.getElementById("expiration_preset");
          if (expirationPresetEl) {
            expirationPresetEl.value = '';
          }
          resetExpirationView();
          
          // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
          updateGenerateButton();
          updateUploadStatus('Ready for new upload session');

          // Scroll to Gallery Link title after layout settles
          setTimeout(() => {
            const galleryLinkTitle = document.getElementById("gallery-link-title");
            const navbar = document.querySelector(".navbar");
            if (galleryLinkTitle) {
              const navHeight = navbar ? navbar.offsetHeight : 0;
              const targetTop = galleryLinkTitle.getBoundingClientRect().top + window.pageYOffset - navHeight - 12;
              window.scrollTo({ top: Math.max(targetTop, 0), behavior: "smooth" });
            }
          }, 80);
          
          showNotification(`‚úÖ QR code generated successfully! Database ID: ${result.autoId}. Ready for next upload.`, 'success');
          
        } else {
          showNotification('Error creating image link: ' + (result.error || 'Unknown error'), 'error');
        }
      } catch (error) {
        showNotification('Network error creating image link. Please check your connection and try again.', 'error');
      } finally {
        // Restore button state
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }

    // Copy tracking code function
    async function copyTrackingCode(trackingCode) {
      try {
        await navigator.clipboard.writeText(trackingCode);
        showNotification(`‚úÖ Access code "${trackingCode}" copied to clipboard!`, 'success');
      } catch (err) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = trackingCode;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification(`‚úÖ Access code copied to clipboard!`, 'success');
      }
    }

    // Copy function with modern clipboard API
    async function myFunctionpic() {
      const copyText = document.getElementById("webinputpic");
      
      try {
        await navigator.clipboard.writeText(copyText.value);
        document.getElementById("Copied").innerHTML = '<span class="copy-success"><i class="fas fa-check me-1"></i>Copied to clipboard!</span>';
        setTimeout(() => {
          document.getElementById("Copied").innerHTML = "";
        }, 3000);
      } catch (err) {
        // Fallback for older browsers
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        document.execCommand("copy");
        document.getElementById("Copied").innerHTML = '<span class="copy-success"><i class="fas fa-check me-1"></i>Copied!</span>';
        setTimeout(() => {
          document.getElementById("Copied").innerHTML = "";
        }, 3000);
      }
    }

    // Show notification function
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
      notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
      notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(notification);
      
      // Auto dismiss after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }

    function formatEndtimeDisplay(endtime) {
      const raw = (endtime ?? '').toString().trim();
      if (!raw) return 'Never';
      const ts = Number.parseInt(raw, 10);
      if (Number.isNaN(ts) || ts <= 0) return 'Never';
      return new Date(ts * 1000).toISOString().replace('T', ' ').substring(0, 19) + ' UTC';
    }

    function initExpirationControls() {
      const preset = document.getElementById('expiration_preset');
      const custom = document.getElementById('expiration_custom_days');
      const hidden = document.getElementById('expiration_day');
      const hiddenTs = document.getElementById('expiration_ts');
      const result = document.getElementById('expiration_result');
      const tzSelect = document.getElementById('timezone_tz');
      const tzRow = document.getElementById('timezone_row');
      const localResult = document.getElementById('expiration_local');
      if (!preset || !custom || !hidden || !hiddenTs || !result || !tzSelect || !localResult) return;

      const pad2 = (n) => String(n).padStart(2, '0');
      let lastExpiry = null;
      let userTouchedTz = false;

      const tzData = [
        { id: 'UTC', label: 'UTC' },
        { id: 'Asia/Shanghai', label: 'China (Asia/Shanghai)' },
        { id: 'Asia/Tokyo', label: 'Japan (Asia/Tokyo)' },
        { id: 'Asia/Seoul', label: 'Korea (Asia/Seoul)' },
        { id: 'Asia/Singapore', label: 'Singapore (Asia/Singapore)' },
        { id: 'Asia/Kolkata', label: 'India (Asia/Kolkata)' },
        { id: 'Europe/London', label: 'UK (Europe/London)' },
        { id: 'Europe/Berlin', label: 'Germany (Europe/Berlin)' },
        { id: 'Europe/Paris', label: 'France (Europe/Paris)' },
        { id: 'Asia/Dubai', label: 'UAE (Asia/Dubai)' },
        { id: 'Australia/Sydney', label: 'Australia (Sydney)' },
        { id: 'America/Sao_Paulo', label: 'Brazil (Sao Paulo)' },
        { id: 'Africa/Johannesburg', label: 'South Africa (Johannesburg)' },
        { id: 'Europe/Moscow', label: 'Russia (Moscow)' },
        { id: 'America/Toronto', label: 'Canada (Toronto)' },
        { id: 'America/New_York', label: 'US Eastern (New York)' },
        { id: 'America/Chicago', label: 'US Central (Chicago)' },
        { id: 'America/Denver', label: 'US Mountain (Denver)' },
        { id: 'America/Los_Angeles', label: 'US Pacific (Los Angeles)' },
        { id: 'America/Anchorage', label: 'US Alaska (Anchorage)' },
        { id: 'Pacific/Honolulu', label: 'US Hawaii (Honolulu)' }
      ];

      const buildZoneOptions = () => {
        tzSelect.innerHTML = '';
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = 'Time zone';
        tzSelect.appendChild(placeholder);
        tzData.forEach((z) => {
          const opt = document.createElement('option');
          opt.value = z.id;
          opt.textContent = z.label;
          tzSelect.appendChild(opt);
        });
      };

      const formatInTimeZone = (date, timeZone) => {
        try {
          return new Intl.DateTimeFormat('en-US', {
            timeZone,
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
          }).format(date);
        } catch (e) {
          return null;
        }
      };

      const updateLocalTime = () => {
        if (!lastExpiry) {
          localResult.textContent = 'Local time: -';
          return;
        }
        const tzId = tzSelect.value;
        if (!tzId) {
          localResult.textContent = 'Local time: -';
          return;
        }
        const formatted = formatInTimeZone(lastExpiry, tzId);
        if (!formatted) {
          localResult.textContent = 'Local time: -';
          return;
        }
        localResult.textContent = `Local time: ${formatted} (${tzId})`;
      };

      const getOffsetMinutes = (tzId, date) => {
        const parts = new Intl.DateTimeFormat('en-US', {
          timeZone: tzId,
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        }).formatToParts(date);
        const map = {};
        parts.forEach((p) => {
          if (p.type !== 'literal') map[p.type] = p.value;
        });
        const asUTC = Date.UTC(
          Number(map.year),
          Number(map.month) - 1,
          Number(map.day),
          Number(map.hour),
          Number(map.minute),
          Number(map.second)
        );
        return Math.round((asUTC - date.getTime()) / 60000);
      };

      const autoSelectTimeZone = () => {
        let browserTz = '';
        try {
          browserTz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
        } catch (e) {
          browserTz = '';
        }
        if (browserTz === 'Etc/UTC' || browserTz === 'Etc/GMT' || browserTz === 'GMT' || browserTz.startsWith('UTC') || browserTz.startsWith('GMT')) {
          browserTz = 'UTC';
        }
        const direct = tzData.find((z) => z.id === browserTz);
        if (direct) {
          tzSelect.value = direct.id;
          updateLocalTime();
          return;
        }

        const localOffset = -new Date().getTimezoneOffset();
        let best = null;
        let bestDiff = Infinity;
        tzData.forEach((z) => {
          try {
            const off = getOffsetMinutes(z.id, new Date());
            const diff = Math.abs(off - localOffset);
            if (diff < bestDiff) {
              bestDiff = diff;
              best = z;
            }
          } catch (e) {
            // ignore invalid timezone
          }
        });

        if (best) {
          tzSelect.value = best.id;
          updateLocalTime();
        }
      };

      const hideExpirationExtras = () => {
        result.style.display = 'none';
        tzRow.style.display = 'none';
        localResult.style.display = 'none';
      };

      const updateExpiration = () => {
        const v = preset.value;
        let days = null;

        if (v === '1h') {
          days = 1 / 24;
        } else if (v === '3h') {
          days = 3 / 24;
        } else if (v === '24h') {
          days = 1;
        } else if (v === '5d') {
          days = 5;
        } else if (v === 'custom') {
          const n = parseFloat(custom.value);
          if (!Number.isNaN(n) && n > 0) {
            days = n;
          }
        }

        if (v === 'custom') {
          custom.style.display = 'block';
        } else {
          custom.style.display = 'none';
          custom.value = '';
        }

        if (v === 'unlimited') {
          hidden.value = '';
          hiddenTs.value = '';
          result.textContent = 'UTC expiry time: Unlimited';
          lastExpiry = null;
          result.style.display = '';
          tzRow.style.display = 'none';
          localResult.style.display = 'none';
          updateLocalTime();
          return;
        }

        if (days === null) {
          hidden.value = '';
          hiddenTs.value = '';
          result.textContent = 'UTC expiry time: -';
          lastExpiry = null;
          hideExpirationExtras();
          updateLocalTime();
          return;
        }

        hidden.value = String(days);
        const now = new Date();
        const expiry = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);
        lastExpiry = expiry;
        hiddenTs.value = String(Math.floor(expiry.getTime() / 1000));
        const utcText = `${expiry.getUTCFullYear()}-${pad2(expiry.getUTCMonth() + 1)}-${pad2(expiry.getUTCDate())} ${pad2(expiry.getUTCHours())}:${pad2(expiry.getUTCMinutes())}:${pad2(expiry.getUTCSeconds())} UTC`;
        result.textContent = `UTC expiry time: ${utcText}`;
        result.style.display = '';
        tzRow.style.display = 'block';
        localResult.style.display = '';
        if (!userTouchedTz) {
          autoSelectTimeZone();
        } else {
          updateLocalTime();
        }
      };

      preset.addEventListener('change', updateExpiration);
      custom.addEventListener('input', updateExpiration);
      tzSelect.addEventListener('change', () => {
        userTouchedTz = true;
        updateLocalTime();
      });

      buildZoneOptions();
      hideExpirationExtras();
      updateExpiration();
      window.__updateMaiimgExpiration = updateExpiration;
    }

    function resetExpirationView() {
      const customEl = document.getElementById('expiration_custom_days');
      const dayEl = document.getElementById('expiration_day');
      const tsEl = document.getElementById('expiration_ts');
      const resultEl = document.getElementById('expiration_result');
      const localEl = document.getElementById('expiration_local');
      const tzRowEl = document.getElementById('timezone_row');
      if (customEl) customEl.value = '';
      if (dayEl) dayEl.value = '';
      if (tsEl) tsEl.value = '';
      if (resultEl) {
        resultEl.textContent = 'UTC expiry time: -';
        resultEl.style.display = 'none';
      }
      if (localEl) {
        localEl.textContent = 'Local time: -';
        localEl.style.display = 'none';
      }
      if (tzRowEl) tzRowEl.style.display = 'none';
      if (typeof window.__updateMaiimgExpiration === 'function') {
        window.__updateMaiimgExpiration();
      }
    }

    // Update button state based on form validation and uploaded files
    function updateGenerateButton() {
      const generateBtn = document.getElementById('generateBtn');
      const generateBtnStatus = document.getElementById('generateBtnStatus');
      const limitInput = document.getElementById('limit');
      const passwordInput = document.getElementById('password');
      const captionInput = document.getElementById('caption');
      
      // Check if all required fields are filled
      const hasLimit = limitInput.value.trim() !== '';
      const hasPassword = passwordInput.value.trim() !== '';
      const hasCaption = captionInput.value.trim() !== '';
      const hasFiles = uploadedFiles.length > 0;
      
      // Enable button only if all conditions are met
      if (hasLimit && hasPassword && hasCaption && hasFiles) {
        generateBtn.disabled = false;
        generateBtnStatus.textContent = 'Ready to generate QR code!';
        generateBtnStatus.className = 'text-success';
      } else {
        generateBtn.disabled = true;
        
        // Show specific missing requirements
        const missing = [];
        if (!hasLimit) missing.push('View limit');
        if (!hasPassword) missing.push('Time control');
        if (!hasCaption) missing.push('Description');
        if (!hasFiles) missing.push('Upload images');
        
        generateBtnStatus.textContent = `Missing: ${missing.join(', ')}`;
        generateBtnStatus.className = 'text-muted';
      }
    }

    // Update upload status function
    function updateUploadStatus(message) {
      const statusElement = document.getElementById('pleaseupload');
      if (statusElement) {
        statusElement.textContent = message;
      }
    }

    // ÁîüÊàêÊñ∞ÁöÑ‰∏ä‰º†‰ºöËØùID
    function generateUploadSessionId() {
      return 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Initialize Dropzone for image upload
    document.addEventListener('DOMContentLoaded', function() {
      // Disable auto discovery
      Dropzone.autoDiscover = false;
      
      // ‰∏çÂú®È°µÈù¢Âä†ËΩΩÊó∂ÁîüÊàê‰ºöËØùIDÔºåÊîπ‰∏∫Âú®Á¨¨‰∏ÄÊ¨°‰∏ä‰º†Êó∂ÁîüÊàê
      initExpirationControls();
      
      myDropzone = new Dropzone("#dropz", {
        url: "https://fetch.maipdf.com/api/upload-image",
        method: "post",
        paramName: "file",
        maxFiles: 25,
        maxFilesize: 50, // 50MB
        acceptedFiles: ".png,.jpg,.jpeg,.gif,.webp,image/*",
        addRemoveLinks: true,
        parallelUploads: 3,
        clickable: true, // Á°Æ‰øùÂèØ‰ª•ÁÇπÂáª
        createImageThumbnails: true, // ÂêØÁî®Áº©Áï•Âõæ
        dictDefaultMessage: '<i class="fas fa-cloud-upload-alt upload-icon"></i><div class="upload-text">Drop images here or click to upload</div><div class="upload-subtext">Supports: PNG, JPG, JPEG, GIF, WebP ‚Ä¢ Max 50MB each ‚Ä¢ Up to 25 files</div>',
        dictMaxFilesExceeded: "Maximum 25 files allowed!",
        dictResponseError: 'Upload failed!',
        dictInvalidFileType: "Only image files are allowed.",
        dictFallbackMessage: "Your browser does not support drag and drop uploads.",
        dictFileTooBig: "File is too big ({{filesize}}MB). Max filesize: {{maxFilesize}}MB.",
        dictRemoveFile: "Remove file",
        dictCancelUpload: "Cancel upload",
        timeout: 300000, // 5 minutes timeout
        
        init: function() {
          const dropzone = this;
          
          this.on("addedfile", function(file) {
            // Âú®Ê∑ªÂä†Á¨¨‰∏Ä‰∏™Êñá‰ª∂Êó∂ÁîüÊàê‰ºöËØùIDÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÁöÑËØùÔºâ
            if (!currentUploadSessionId) {
              currentUploadSessionId = generateUploadSessionId();
              console.log(`New upload session started: ${currentUploadSessionId}`);
            }
            
            updateUploadStatus(`Added: ${file.name} (Session: ${currentUploadSessionId})`);
            console.log(`File added: ${file.name}, Session ID: ${currentUploadSessionId}`);
          });
          
          this.on("sending", function(file, xhr, formData) {
            updateUploadStatus(`Uploading: ${file.name}...`);
            
            // Á°Æ‰øù‰ΩøÁî®ÂΩìÂâç‰ºöËØùID
            if (!currentUploadSessionId) {
              currentUploadSessionId = generateUploadSessionId();
            }
            
            // ÈÄöËøáËØ∑Ê±ÇÂ§¥ÂèëÈÄÅ‰ºöËØùIDÔºàÂêéÁ´ØAPI‰ªéËØ∑Ê±ÇÂ§¥‰∏≠ËØªÂèñÔºâ
            xhr.setRequestHeader('X-Upload-Session-Id', currentUploadSessionId);
            console.log(`Uploading file: ${file.name} with Session ID: ${currentUploadSessionId}`);
          });
          
          this.on("success", function(file, response) {
            try {
              const result = typeof response === 'string' ? JSON.parse(response) : response;
              
              if (result.success) {
                // Add to uploaded files array with all necessary fields
                uploadedFiles.push({
                  filename: result.filename,
                  originalName: file.name,
                  size: file.size,
                  url: result.url,
                  directory: result.directory || currentUploadSessionId,
                  uploadSessionId: currentUploadSessionId
                });
                
                updateUploadStatus(`‚úÖ Uploaded: ${file.name} (Folder: ${result.directory || currentUploadSessionId})`);
                updateGenerateButton(); // Update button state when files are uploaded
                
                console.log(`File uploaded successfully: ${file.name}, Directory: ${result.directory || currentUploadSessionId}`);
                
              } else {
                updateUploadStatus(`‚ùå Failed: ${file.name} - ${result.error}`);
              }
            } catch (error) {
              updateUploadStatus(`‚ùå Error processing: ${file.name}`);
              console.error('Error processing upload response:', error);
            }
          });
          
          this.on("error", function(file, errorMessage) {
            updateUploadStatus(`‚ùå Error: ${file.name} - ${errorMessage}`);
            console.error(`Upload error for ${file.name}:`, errorMessage);
          });
          
          this.on("removedfile", function(file) {
            // Remove from uploaded files array
            uploadedFiles = uploadedFiles.filter(f => f.originalName !== file.name);
            updateUploadStatus(`Removed: ${file.name}`);
            updateGenerateButton(); // Update button state when files are removed
            console.log(`File removed: ${file.name}, Remaining files: ${uploadedFiles.length}`);
            
            // Â¶ÇÊûúÊâÄÊúâÊñá‰ª∂ÈÉΩË¢´Âà†Èô§‰∫ÜÔºåÈáçÁΩÆ‰ºöËØùID
            if (uploadedFiles.length === 0) {
              currentUploadSessionId = null;
              updateUploadStatus('Ready for new upload session');
            }
          });
          
          this.on("queuecomplete", function() {
            if (uploadedFiles.length > 0) {
              updateUploadStatus(`Ready! ${uploadedFiles.length} files uploaded to folder: ${currentUploadSessionId}`);
            } else {
              updateUploadStatus('Ready for new upload session');
            }
            console.log(`Upload queue complete. Total files: ${uploadedFiles.length}, Session ID: ${currentUploadSessionId}`);
          });
          
          this.on("reset", function() {
            // ÂΩì dropzone ÈáçÁΩÆÊó∂Ôºå‰∏çÁ´ãÂç≥ÁîüÊàêÊñ∞ÁöÑ session ID
            currentUploadSessionId = null;
            uploadedFiles = [];
            updateUploadStatus('Upload area reset - ready for new images');
            console.log(`Dropzone reset. Session ID cleared.`);
          });
        }
      });

      // Add real-time validation listeners
      ['limit', 'password', 'caption', 'expiration_preset', 'expiration_custom_days'].forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', updateGenerateButton);
          field.addEventListener('blur', updateGenerateButton);
          field.addEventListener('change', updateGenerateButton);
        }
      });

      // WiFi form listeners
      ["myInput1", "myInput2", "myInput3"].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener("input", makeCode);
          element.addEventListener("keydown", function(e) {
            if (e.key === 'Enter') makeCode();
          });
        }
      });

      // SMS form listeners
      ["smsNumber", "smsContent"].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener("input", makeCode);
          element.addEventListener("keydown", function(e) {
            if (e.key === 'Enter') makeCode();
          });
        }
      });

      // Other form listeners
      ["webinput", "telinput"].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener("input", makeCodeweb);
          element.addEventListener("keydown", function(e) {
            if (e.key === 'Enter') makeCodeweb();
          });
        }
      });

      // Initialize empty QR codes
      createQRCode("qrcode", "");
      createQRCode("smsCode", "");
      createQRCode("qrcodeweb", "");
      createQRCode("qrcodetel", "");
      createQRCode("qrcodewebpic", "");

      // Initial button state check
      updateGenerateButton();

      // Initialize translations
      initializeTranslations();
      updateFooterComplianceText(window.i18n ? window.i18n.currentLanguage : currentLanguage);
      
      // Load saved language preference
      const savedLanguage = localStorage.getItem('preferred-language');
      const supportedLanguages = ['en', 'zh', 'tw', 'ja', 'de', 'ko', 'fr', 'it'];
      if (savedLanguage && supportedLanguages.includes(savedLanguage)) {
        changeLanguage(savedLanguage);
      }

      // Smooth scrolling for navigation links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const href = this.getAttribute('href');
          if (href && href !== '#') {
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth' });
            }
          }
        });
      });
    });
  </script>
</body>
</html>
