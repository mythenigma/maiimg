<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Test - MaiIMG</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
        .step { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        code { background: #f8f9fa; padding: 2px 6px; border-radius: 4px; }
        .test-btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .test-btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>🔍 MaiIMG 重定向流程测试</h1>
    
    <div class="info step">
        <h3>📋 当前方案确认</h3>
        <p><strong>文件结构:</strong></p>
        <ul>
            <li><code>_redirects</code> - 重定向规则文件</li>
            <li><code>pic-redirect.html</code> - JavaScript 处理页面</li>
            <li><code>view.html</code> - 原始图片展示页面</li>
        </ul>
    </div>

    <div class="step">
        <h3>🔄 预期工作流程</h3>
        <ol>
            <li>用户访问: <code>https://maiimg.com/pic/CF</code></li>
            <li>Cloudflare Pages 根据 <code>_redirects</code> 重写为: <code>/pic-redirect.html</code></li>
            <li><code>pic-redirect.html</code> 的 JavaScript 从原始 URL 提取 ID: <code>CF</code></li>
            <li>自动重定向到: <code>/view.html?id=CF</code></li>
            <li><code>view.html</code> 解析参数并显示图片</li>
        </ol>
    </div>

    <div class="step">
        <h3>🧪 测试链接</h3>
        <button class="test-btn" onclick="testRedirect('/pic/CF')">测试: /pic/CF (真实案例)</button>
        <button class="test-btn" onclick="testRedirect('/pic/TEST123')">测试: /pic/TEST123</button>
        <button class="test-btn" onclick="testRedirect('/pic/DEMO')">测试: /pic/DEMO</button>
        <br><br>
        <button class="test-btn" onclick="testDirect('/pic-redirect.html')">直接测试: pic-redirect.html</button>
        <button class="test-btn" onclick="testDirect('/view.html?id=DIRECT')">直接测试: view.html?id=DIRECT</button>
    </div>

    <div id="test-results" class="step" style="display: none;">
        <h3>📊 测试结果</h3>
        <div id="results-content"></div>
    </div>

    <div class="success step">
        <h3>✅ 确认清单</h3>
        <ul>
            <li>✅ <code>_redirects</code> 文件内容: <code>/pic/* /pic-redirect.html 200</code></li>
            <li>✅ <code>pic-redirect.html</code> 包含 JavaScript 重定向逻辑</li>
            <li>✅ <code>view.html</code> 能正确解析 <code>?id=</code> 参数</li>
            <li>✅ 所有文件在项目根目录</li>
        </ul>
    </div>

    <div class="info step">
        <h3>🚀 部署命令</h3>
        <code>
            git add .<br>
            git commit -m "JavaScript 重定向方案 - 最终版本"<br>
            git push origin main
        </code>
    </div>

    <script>
        function testRedirect(path) {
            const fullUrl = window.location.origin + path;
            const resultsDiv = document.getElementById('test-results');
            const contentDiv = document.getElementById('results-content');
            
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = `
                <p><strong>测试链接:</strong> <a href="${path}" target="_blank">${fullUrl}</a></p>
                <p><strong>预期行为:</strong> 应该重定向到 view.html 并显示对应图片</p>
                <p><strong>点击上面的链接进行测试</strong></p>
            `;
        }

        function testDirect(path) {
            const fullUrl = window.location.origin + path;
            window.open(path, '_blank');
        }

        // 显示当前页面信息
        document.addEventListener('DOMContentLoaded', function() {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'step info';
            infoDiv.innerHTML = `
                <h3>📍 当前页面信息</h3>
                <p><strong>URL:</strong> ${window.location.href}</p>
                <p><strong>域名:</strong> ${window.location.hostname}</p>
                <p><strong>时间:</strong> ${new Date().toLocaleString()}</p>
            `;
            document.body.appendChild(infoDiv);
        });
    </script>
</body>
</html>
