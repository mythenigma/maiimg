<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirect Rules Test - MaiIMG</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .test-link {
            display: block;
            padding: 12px 20px;
            margin: 10px 0;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.3s;
        }
        .test-link:hover {
            background: #0056b3;
        }
        .info {
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 Cloudflare Pages 重写规则测试</h1>
        
        <div class="info">
            <h3>📋 测试说明</h3>
            <p>这个页面用于测试 Cloudflare Pages 的重写规则是否正确工作。点击下面的链接来测试不同的重写场景。</p>
        </div>

        <div class="test-section">
            <h3>🖼️ 图片展示重写测试</h3>
            <p>测试 <code>/pic/ID</code> 是否正确重写为 <code>/view.html?id=ID</code></p>
            
            <a href="/pic/CF" class="test-link" target="_blank">测试链接: /pic/CF (您的实际案例)</a>
            <a href="/pic/A" class="test-link" target="_blank">测试链接: /pic/A</a>
            <a href="/pic/ABCD" class="test-link" target="_blank">测试链接: /pic/ABCD</a>
            
            <div class="code">
                ✅ 修复后的预期行为:<br>
                /pic/CF → /view.html?id=CF (应该能正常加载)<br>
                /pic/A → /view.html?id=A<br>
                /pic/ABCD → /view.html?id=ABCD
            </div>
            
            <div class="status error">
                <strong>⚠️ 之前的问题:</strong> /pic/CF 跳转到 /view 而不是 /view.html?id=CF
            </div>
            
            <div class="status success">
                <strong>✅ 修复说明:</strong> 简化了重写规则语法，移除了可能导致冲突的配置
            </div>
        </div>

        <div class="test-section">
            <h3>📊 追踪页面重写测试</h3>
            <p>测试 <code>/track/CODE</code> 是否正确重写为 <code>/tracking.html?id=CODE</code></p>
            
            <a href="/track/TEST123" class="test-link" target="_blank">测试链接: /track/TEST123</a>
            <a href="/track/TRACK456" class="test-link" target="_blank">测试链接: /track/TRACK456</a>
            
            <div class="code">
                预期行为: /track/TEST123 → /tracking.html?id=TEST123<br>
                预期行为: /track/TRACK456 → /tracking.html?id=TRACK456
            </div>
        </div>

        <div class="test-section">
            <h3>🏠 主页重写测试</h3>
            <p>测试其他路径是否正确重定向到主页</p>
            
            <a href="/qr" class="test-link" target="_blank">测试链接: /qr</a>
            <a href="/generate" class="test-link" target="_blank">测试链接: /generate</a>
            <a href="/gallery" class="test-link" target="_blank">测试链接: /gallery</a>
            
            <div class="code">
                预期行为: /qr → /index.html<br>
                预期行为: /generate → /index.html<br>
                预期行为: /gallery → /index.html
            </div>
        </div>

        <div class="info">
            <h3>✅ 验证步骤</h3>
            <ol>
                <li>确保 <code>_redirects</code> 文件已上传到 Cloudflare Pages</li>
                <li>部署您的网站到 Cloudflare Pages</li>
                <li>点击上面的测试链接</li>
                <li>检查浏览器地址栏是否显示重写后的 URL</li>
                <li>检查页面内容是否正确加载</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>🛠️ 调试信息</h3>
            <p>当前页面信息：</p>
            <div class="code" id="debug-info">
                <script>
                    document.getElementById('debug-info').innerHTML = `
                        <strong>当前 URL:</strong> ${window.location.href}<br>
                        <strong>域名:</strong> ${window.location.hostname}<br>
                        <strong>路径:</strong> ${window.location.pathname}<br>
                        <strong>查询参数:</strong> ${window.location.search}<br>
                        <strong>User-Agent:</strong> ${navigator.userAgent}
                    `;
                </script>
            </div>
        </div>

        <div class="info">
            <h3>📝 配置文件内容</h3>
            <p>以下是 <code>_redirects</code> 文件的关键内容：</p>
            <div class="code">
# 图片展示重写规则<br>
/pic/:id               /view.html?id=:id           200<br><br>

# 追踪页面重写规则<br>
/track/:trackingCode   /tracking.html?id=:trackingCode   200<br><br>

# 主页重写规则<br>
/                      /index.html                 200<br>
/qr                    /index.html                 200<br>
/generate              /index.html                 200<br>
/gallery               /index.html                 200
            </div>
        </div>
    </div>
</body>
</html>
