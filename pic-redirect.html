<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .loading {
            text-align: center;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
        <h2>Loading Gallery...</h2>
        <p>Redirecting to your images</p>
    </div>

    <script>
        // 从 URL 中提取 ID
        function extractIdFromUrl() {
            const url = window.location.href;
            console.log('Current URL:', url);
            
            // 首先尝试从 URL 参数中获取（如果有的话）
            const urlParams = new URLSearchParams(window.location.search);
            const idFromParams = urlParams.get('id');
            if (idFromParams) {
                console.log('Found ID in URL params:', idFromParams);
                return idFromParams;
            }
            
            // 尝试从原始 URL 路径中提取
            let match = url.match(/\/pic\/([^\/\?#]+)/);
            if (match) {
                console.log('Found ID in URL path:', match[1]);
                return match[1];
            }
            
            // 备用方案：从 referrer 中提取
            if (document.referrer) {
                console.log('Checking referrer:', document.referrer);
                match = document.referrer.match(/\/pic\/([^\/\?#]+)/);
                if (match) {
                    console.log('Found ID in referrer:', match[1]);
                    return match[1];
                }
            }
            
            // 最后尝试：从 document.location 的完整信息中提取
            const fullPath = window.location.pathname + window.location.search + window.location.hash;
            console.log('Full path to check:', fullPath);
            match = fullPath.match(/pic[^\/]*\/([^\/\?#]+)/);
            if (match) {
                console.log('Found ID in full path:', match[1]);
                return match[1];
            }
            
            return null;
        }
        
        // 延迟一点点再重定向，确保页面加载完成
        setTimeout(() => {
            const id = extractIdFromUrl();
            if (id) {
                console.log('✅ Extracted ID:', id);
                console.log('🔄 Redirecting to:', `/view.html?id=${id}`);
                // 使用 replace 避免在浏览器历史中留下记录
                window.location.replace(`/view.html?id=${id}`);
            } else {
                console.error('❌ Could not extract ID from URL');
                // 如果没有找到 ID，显示错误信息
                document.querySelector('.loading').innerHTML = `
                    <h2>⚠️ Invalid Link</h2>
                    <p>Could not extract image ID from URL</p>
                    <p><strong>Current URL:</strong> ${window.location.href}</p>
                    <p><strong>Referrer:</strong> ${document.referrer || 'None'}</p>
                    <a href="/" style="color: white; text-decoration: underline; margin-top: 20px; display: inline-block;">Go to Homepage</a>
                `;
            }
        }, 100); // 100ms 延迟
    </script>
</body>
</html>
