<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .loading {
            text-align: center;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
        <h2>Loading Gallery...</h2>
        <p>Redirecting to your images</p>
    </div>

    <script>
        // ä» URL ä¸­æå– ID
        function extractIdFromUrl() {
            const url = window.location.href;
            console.log('Current URL:', url);
            
            // é¦–å…ˆå°è¯•ä» URL å‚æ•°ä¸­è·å–ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            const urlParams = new URLSearchParams(window.location.search);
            const idFromParams = urlParams.get('id');
            if (idFromParams) {
                console.log('Found ID in URL params:', idFromParams);
                return idFromParams;
            }
            
            // å°è¯•ä»åŸå§‹ URL è·¯å¾„ä¸­æå–
            let match = url.match(/\/pic\/([^\/\?#]+)/);
            if (match) {
                console.log('Found ID in URL path:', match[1]);
                return match[1];
            }
            
            // å¤‡ç”¨æ–¹æ¡ˆï¼šä» referrer ä¸­æå–
            if (document.referrer) {
                console.log('Checking referrer:', document.referrer);
                match = document.referrer.match(/\/pic\/([^\/\?#]+)/);
                if (match) {
                    console.log('Found ID in referrer:', match[1]);
                    return match[1];
                }
            }
            
            // æœ€åå°è¯•ï¼šä» document.location çš„å®Œæ•´ä¿¡æ¯ä¸­æå–
            const fullPath = window.location.pathname + window.location.search + window.location.hash;
            console.log('Full path to check:', fullPath);
            match = fullPath.match(/pic[^\/]*\/([^\/\?#]+)/);
            if (match) {
                console.log('Found ID in full path:', match[1]);
                return match[1];
            }
            
            return null;
        }
        
        // å»¶è¿Ÿä¸€ç‚¹ç‚¹å†é‡å®šå‘ï¼Œç¡®ä¿é¡µé¢åŠ è½½å®Œæˆ
        setTimeout(() => {
            const id = extractIdFromUrl();
            if (id) {
                console.log('âœ… Extracted ID:', id);
                console.log('ğŸ”„ Redirecting to:', `/view.html?id=${id}`);
                // ä½¿ç”¨ replace é¿å…åœ¨æµè§ˆå™¨å†å²ä¸­ç•™ä¸‹è®°å½•
                window.location.replace(`/view.html?id=${id}`);
            } else {
                console.error('âŒ Could not extract ID from URL');
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ° IDï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.querySelector('.loading').innerHTML = `
                    <h2>âš ï¸ Invalid Link</h2>
                    <p>Could not extract image ID from URL</p>
                    <p><strong>Current URL:</strong> ${window.location.href}</p>
                    <p><strong>Referrer:</strong> ${document.referrer || 'None'}</p>
                    <a href="/" style="color: white; text-decoration: underline; margin-top: 20px; display: inline-block;">Go to Homepage</a>
                `;
            }
        }, 100); // 100ms å»¶è¿Ÿ
    </script>
</body>
</html>
