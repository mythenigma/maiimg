<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>work - 最新工作记录</title>
  <style>
    :root { --bg:#f6f8fb; --card:#fff; --text:#111827; --muted:#6b7280; --line:#e5e7eb; --ok:#065f46; --info:#1d4ed8; }
    * { box-sizing:border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font-family:"PingFang SC","Microsoft YaHei",sans-serif; line-height:1.6; }
    .wrap { max-width:1000px; margin:24px auto; padding:0 16px 30px; }
    .head { background:linear-gradient(135deg,#dbeafe,#e0e7ff); border:1px solid #bfdbfe; border-radius:12px; padding:16px 18px; margin-bottom:12px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:14px 16px; margin-bottom:12px; }
    h1 { margin:0 0 6px; font-size:22px; }
    h2 { margin:0; font-size:17px; }
    p { margin:8px 0; font-size:14px; }
    ul { margin:8px 0 0 18px; padding:0; }
    code { background:#f3f4f6; border-radius:6px; padding:1px 6px; font-size:13px; font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
    .row { display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
    .tag { font-size:12px; font-weight:600; border-radius:999px; padding:2px 8px; border:1px solid; white-space:nowrap; }
    .ok { color:var(--ok); border-color:#a7f3d0; background:#ecfdf5; }
    .info { color:var(--info); border-color:#bfdbfe; background:#eff6ff; }
    .sub, .foot { color:var(--muted); font-size:12px; }
    .mermaid { min-height: 120px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
  <main class="wrap">
    <section class="head">
      <h1>最新工作记录</h1>
      <p class="sub">更新时间：2026-02-25</p>
    </section>

    <section class="card">
      <div class="row"><h2>1) 首页底部链接（手机端）排版优化</h2><span class="tag ok">已完成</span></div>
      <ul>
        <li>修复 footer 链接在小屏挤压换行问题。</li>
        <li>手机端改为稳定网格：前两项同排，第三项独占一行居中。</li>
      </ul>
      <p><strong>文件：</strong><code>qr-styles010.css</code></p>
    </section>

    <section class="card">
      <div class="row"><h2>2) 登录提醒逻辑统一（index/maiimg）</h2><span class="tag ok">已完成</span></div>
      <ul>
        <li>新增未登录提醒弹窗（Sign In / Maybe Later）。</li>
        <li>频控：<code>1 小时内不重复提醒</code>（localStorage 时间戳）。</li>
        <li>两页逻辑完全同步：<code>index.html</code> 与 <code>maiimg.html</code>。</li>
      </ul>
    </section>

    <section class="card">
      <div class="row"><h2>3) 触发时机已按你要求收敛</h2><span class="tag info">已确认</span></div>
      <ul>
        <li>当前只在用户开始上传（Dropzone <code>addedfile</code>）时触发提醒。</li>
        <li>已删除“生成成功后再提醒”的旧触发，避免无效/重复打扰。</li>
      </ul>
      <p><strong>文件：</strong><code>index.html</code>、<code>maiimg.html</code></p>
    </section>

    <section class="card">
      <div class="row"><h2>4) Dashboard 替换交互（前面已完成）</h2><span class="tag ok">已完成</span></div>
      <ul>
        <li>手机版 A/B 选择按钮化 + 底部固定替换栏。</li>
        <li>顶部替换关系可视化为 <code>A ← B</code>，并带轻动效。</li>
        <li>新增文案已补齐多语言键，英文为基础默认。</li>
      </ul>
      <p><strong>文件：</strong><code>dashboard.html</code>、<code>i18n.js</code></p>
    </section>

    <section class="card">
      <div class="row"><h2>5) Dashboard 登出与首页登录状态同步</h2><span class="tag info">待做</span></div>
      <p><strong>问题：</strong>Dashboard 检测登录只读 <code>sessionStorage.maiimg_jwt</code>；登出时只清除 sessionStorage 并跳转 maiimg.html，<strong>未调用 Firebase signOut</strong>。结果：① 跳转到 maiimg 后 Firebase 仍为已登录，<code>onAuthStateChanged</code> 会再次写入 JWT，用户马上又显示已登录；② 多标签时，另一标签的 index 与 dashboard 各自一份 sessionStorage，在 dashboard 登出不会让另一标签的 index 登出。</p>
      <p><strong>交互关系（Mermaid）：</strong></p>
      <pre class="mermaid" style="background:#f8fafc;border-radius:8px;padding:12px;overflow:auto;font-size:12px;">
flowchart TB
  subgraph same["同源同标签"]
    A["index/maiimg"]
    B["dashboard"]
    S["sessionStorage JWT"]
    A -->|"登录 workerAuth"| S
    S -->|"checkAuth 读取"| B
    B -->|"登出仅清 storage"| S2["storage 清空"]
    S2 -->|"跳转 maiimg"| C["maiimg 加载"]
    C -->|"Firebase 仍登录"| F["onAuthStateChanged"]
    F -->|"再次写入 JWT"| S
  end

  subgraph tabs["多标签"]
    T1["标签A index"]
    T2["标签B dashboard"]
    ST1["sessionStorage A"]
    ST2["sessionStorage B"]
    T1 --> ST1
    T2 --> ST2
    T2 -->|"登出只清 B"| ST2
    ST1 -.->|"不受影响"| T1
  end

  subgraph fix["修复方案"]
    D1["dashboard 调用 signOut"]
    D2["可选: 广播其他标签"]
    D1 --> D2
  end
      </pre>
      <p><strong>修复要点：</strong></p>
      <ul>
        <li>在 <code>dashboard.html</code> 的 <code>logout()</code> 中：引入 Firebase Auth（与 index/maiimg 同配置），先调用 <code>signOut(auth)</code>，再清除 sessionStorage，最后跳转 maiimg.html。</li>
        <li>可选（多标签一致）：登出时向 <code>localStorage</code> 写一条“登出”标记或发 <code>BroadcastChannel</code> 消息；<code>index.html</code> / <code>maiimg.html</code> 监听 <code>storage</code> 或 <code>message</code>，收到后执行 <code>signOut</code> + 清除 sessionStorage + 刷新或更新 UI。</li>
      </ul>
      <p><strong>涉及文件：</strong><code>dashboard.html</code>（登出逻辑 + 可选 Firebase 引入）、<code>index.html</code> / <code>maiimg.html</code>（可选：监听跨标签登出）。</p>
    </section>

    <section class="card">
      <div class="row"><h2>6) 项目看法与改善建议（Roadmap）</h2><span class="tag info">建议</span></div>
      <p><strong>当前判断：</strong>MaiIMG 已具备“上传-分享-追踪-管理”的完整闭环，功能已经不弱；下一步重点应从“能用”转向“稳定转化 + 性能体验 + 内容增长”。</p>
      <ul>
        <li><strong>P0（优先）：登录转化与新功能可见性</strong>：未登录上传提醒继续保留；在生成成功区增加“登录后可管理历史链接/替换/访问记录”的固定提示；把“到期时间设置”放入首页与 blog 的首屏文案。</li>
        <li><strong>P0（优先）：移动端体验一致性</strong>：统一 index / maiimg / dashboard 的头部、按钮高度、卡片间距；减少手机版操作跳转层级，关键动作保持单屏可见。</li>
        <li><strong>P1：Gallery 加载策略</strong>：保持逐张懒加载，增加“缩略图 + 原图”两级资源与下一张预加载，优先提升弱网首屏速度，不建议先做复杂 chunk。</li>
        <li><strong>P1：数据与埋点</strong>：补齐关键漏斗事件（打开上传、开始上传、生成成功、点击登录、完成登录、进入 dashboard），每周看转化率再迭代文案和交互。</li>
        <li><strong>P1：SEO/知识库体系</strong>：围绕真实功能写主题（过期时间、访问记录、A/B 替换、登录管理）；每篇固定结构：问题场景 → 操作步骤 → 常见问题 → 相关功能入口。</li>
        <li><strong>P2：可信度建设</strong>：补“隐私与存储时长说明”“游客与登录用户能力对比”“常见错误码说明”，降低新用户不确定感。</li>
      </ul>
      <p><strong>建议执行方式：</strong>先做 P0 两周冲刺（转化+移动端），再做 P1（性能+内容+埋点），每周复盘一次核心指标。</p>
      <p><strong>相关页面：</strong><code>index.html</code>、<code>maiimg.html</code>、<code>gallery/index.html</code>、<code>dashboard.html</code>、<code>work.html</code></p>
    </section>

    <p class="foot">备注：本页为最新执行记录，按你的确认状态更新。</p>
  </main>
  <script>
    mermaid.initialize({ startOnLoad: true, theme: 'neutral', flowchart: { useMaxWidth: true, htmlLabels: true } });
  </script>
</body>
</html>
